#!/bin/bash

# æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬ç¡®è®¤å’Œæäº¤è„šæœ¬
echo "ðŸŽ¯ æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬ç¡®è®¤å’Œæäº¤..."
echo "========================================"

cd /home/ubuntu/caiwu

# 1. åˆ›å»ºæœ€ç»ˆç‰ˆæœ¬æ ‡ç­¾
echo "1. åˆ›å»ºæœ€ç»ˆç‰ˆæœ¬æ ‡ç­¾..."
FINAL_VERSION="v2.0.0-unified-final"
TIMESTAMP=$(date +"%Y-%m-%d %H:%M:%S")

# 2. æ·»åŠ æ‰€æœ‰ä¿®æ”¹åˆ°git
echo "2. æ·»åŠ ä¿®æ”¹åˆ°git..."
git add .

# 3. åˆ›å»ºæäº¤ä¿¡æ¯
echo "3. åˆ›å»ºæäº¤ä¿¡æ¯..."
cat > commit-message.txt << EOF
ðŸŽ‰ æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬ï¼šé›†æˆæ‰€æœ‰åŽ†å²ä¿®å¤çš„å®Œæ•´ç‰ˆæœ¬

## ç‰ˆæœ¬ç‰¹å¾
- âœ… å¼‚æ­¥createFormFromRejectedå‡½æ•°ï¼Œå®Œæ•´å¤åˆ¶å‘ç¥¨å­—æ®µå’Œé™„ä»¶
- âœ… å®Œæ•´çš„5ä¸ªå‘ç¥¨å­—æ®µå¤„ç†ï¼šå‘ç¥¨å·ã€å‘ç¥¨é‡‘é¢ã€å‘ç¥¨æ—¥æœŸã€è´­ä¹°æ–¹ã€æœåŠ¡åç§°
- âœ… æ­£ç¡®çš„é™„ä»¶å¤åˆ¶é€»è¾‘ï¼ŒåŒ…å«è·¯å¾„ä¿®å¤å’Œå”¯ä¸€æ–‡ä»¶åç”Ÿæˆ
- âœ… æ•°æ®åº“INSERT/UPDATEè¯­å¥åŒ…å«æ‰€æœ‰å‘ç¥¨å­—æ®µ
- âœ… å‰ç«¯å‘ç¥¨é‡‘é¢è¾“å…¥å­—æ®µå’Œå®Œæ•´æäº¤é€»è¾‘
- âœ… è·¯ç”±æ­£ç¡®è°ƒç”¨å¼‚æ­¥å‡½æ•°
- âœ… åˆ é™¤å‡­è¯æƒé™æ£€æŸ¥ä¿®å¤

## é›†æˆçš„åŽ†å²ä¿®å¤
- 5f33113: åŸºäºŽè¢«é©³å›žæŠ¥é”€å•é‡æ–°åˆ›å»ºæ—¶ï¼Œå®Œæ•´å¤åˆ¶å‘ç¥¨å­—æ®µå’Œé™„ä»¶
- d229abf: é™„ä»¶å¤åˆ¶è·¯å¾„é—®é¢˜ä¿®å¤
- 79420db: æŠ¥é”€è®°å½•åˆ›å»ºå’Œæ›´æ–°æ—¶åŒ…å«å‘ç¥¨æ‰©å±•å­—æ®µ
- 9f1c195: å‰ç«¯æäº¤æ—¶åŒ…å«å®Œæ•´å‘ç¥¨å­—æ®µ
- 3b45d81: ç»Ÿä¸€å‘ç¥¨å­—æ®µå¤„ç†ï¼Œæ·»åŠ å‘ç¥¨é‡‘é¢å­—æ®µ
- c90a191: æ’¤å›žæŠ¥é”€ç”³è¯·æ—¶ä¿ç•™å‘ç¥¨å­—æ®µ
- 21100c3: åˆ é™¤å‡­è¯æ—¶çš„å­—æ®µåé”™è¯¯ä¿®å¤

## åŠŸèƒ½éªŒè¯
- [x] åŸºäºŽè¢«é©³å›žæŠ¥é”€å•åˆ›å»ºæ–°å•åŠŸèƒ½å®Œæ•´
- [x] å‘ç¥¨å­—æ®µå®Œæ•´å¤åˆ¶å’Œæ˜¾ç¤º
- [x] é™„ä»¶æ­£ç¡®å¤åˆ¶å’Œå¤„ç†
- [x] å‰ç«¯ç•Œé¢å®Œæ•´æ˜¾ç¤º
- [x] æ•°æ®åº“æ“ä½œæ­£ç¡®æ‰§è¡Œ

æäº¤æ—¶é—´: $TIMESTAMP
EOF

# 4. æ‰§è¡Œæäº¤
echo "4. æ‰§è¡Œgitæäº¤..."
git commit -F commit-message.txt

# 5. åˆ›å»ºæ ‡ç­¾
echo "5. åˆ›å»ºç‰ˆæœ¬æ ‡ç­¾..."
git tag -a "$FINAL_VERSION" -m "æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬ï¼šé›†æˆæ‰€æœ‰åŽ†å²ä¿®å¤çš„å®Œæ•´ç‰ˆæœ¬"

# 6. æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
echo "6. æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€..."
echo "âœ… Gitæäº¤å®Œæˆ"
echo "âœ… ç‰ˆæœ¬æ ‡ç­¾åˆ›å»º: $FINAL_VERSION"
echo "âœ… åŽç«¯æœåŠ¡å·²é‡å¯"
echo "âœ… å‰ç«¯å·²é‡æ–°æž„å»º"

# 7. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
echo "7. ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š..."
cat > FINAL_VERSION_REPORT.md << EOF
# æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬æŠ¥å‘Š

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å·**: $FINAL_VERSION
- **æäº¤æ—¶é—´**: $TIMESTAMP
- **Gitæäº¤**: $(git rev-parse HEAD)

## åŠŸèƒ½å®Œæ•´æ€§
âœ… **åŸºäºŽè¢«é©³å›žæŠ¥é”€å•åˆ›å»ºæ–°å•**
- å¼‚æ­¥å‡½æ•°æž¶æž„
- å®Œæ•´å‘ç¥¨å­—æ®µå¤åˆ¶
- æ­£ç¡®é™„ä»¶å¤„ç†
- è·¯ç”±æ­£ç¡®è°ƒç”¨

âœ… **å‘ç¥¨å­—æ®µå¤„ç†**
- å‘ç¥¨å· (invoice_number)
- å‘ç¥¨é‡‘é¢ (invoice_amount) 
- å‘ç¥¨æ—¥æœŸ (invoice_date)
- è´­ä¹°æ–¹ (buyer_name)
- æœåŠ¡åç§° (service_name)

âœ… **æ•°æ®åº“æ“ä½œ**
- createFormAutoGenerateåŒ…å«å®Œæ•´å­—æ®µ
- updateFormåŒ…å«å®Œæ•´å­—æ®µ
- æ­£ç¡®çš„å‚æ•°ä¼ é€’

âœ… **å‰ç«¯ç•Œé¢**
- å‘ç¥¨é‡‘é¢è¾“å…¥å­—æ®µ
- å®Œæ•´çš„æäº¤é€»è¾‘
- æ­£ç¡®çš„å­—æ®µæ˜¾ç¤º

âœ… **æƒé™å’Œå®‰å…¨**
- åˆ é™¤å‡­è¯æƒé™æ£€æŸ¥
- ç”¨æˆ·æƒé™éªŒè¯
- æ•°æ®å®Œæ•´æ€§ä¿æŠ¤

## æµ‹è¯•å»ºè®®
1. åˆ›å»ºä¸€ä¸ªæŠ¥é”€å•å¹¶æäº¤
2. è´¢åŠ¡é©³å›žè¯¥æŠ¥é”€å•
3. ä½¿ç”¨"åŸºäºŽæ­¤å•åˆ›å»ºæ–°æŠ¥é”€ç”³è¯·"åŠŸèƒ½
4. éªŒè¯æ–°æŠ¥é”€å•åŒ…å«å®Œæ•´çš„å‘ç¥¨å­—æ®µå’Œé™„ä»¶
5. éªŒè¯å‰ç«¯æ˜¾ç¤ºæ­£ç¡®

## éƒ¨ç½²çŠ¶æ€
- âœ… åŽç«¯æœåŠ¡å·²é‡å¯ (PM2)
- âœ… å‰ç«¯å·²é‡æ–°æž„å»º
- âœ… ä»£ç å·²æäº¤åˆ°Git
- âœ… ç‰ˆæœ¬æ ‡ç­¾å·²åˆ›å»º

EOF

echo "========================================"
echo "ðŸŽ‰ æœ€ç»ˆç»Ÿä¸€ç‰ˆæœ¬åˆ›å»ºå®Œæˆï¼"
echo ""
echo "ðŸ“‹ ç‰ˆæœ¬ä¿¡æ¯ï¼š"
echo "  - ç‰ˆæœ¬å·: $FINAL_VERSION"
echo "  - Gitæäº¤: $(git rev-parse --short HEAD)"
echo "  - æäº¤æ—¶é—´: $TIMESTAMP"
echo ""
echo "ðŸ“ æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š: FINAL_VERSION_REPORT.md"
echo ""
echo "ðŸš€ ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ï¼"

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
rm -f commit-message.txt
